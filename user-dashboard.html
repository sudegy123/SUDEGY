<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>لوحة تحكم — SudEgy</title>

  <!-- خطوط -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f1724; --panel:#0b1220; --muted:#93a3b6; --accent:#f97316; /* SudEgy orange */
      --accent-dark:#d97706; --success:#10b981; --danger:#ef4444; --card:#0b1624; --glass: rgba(255,255,255,0.03);
      --rounded:14px;
    }
    *{box-sizing:border-box;font-family:Inter, system-ui, Arial;}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#071026);color:#e6eef8}
    a { color:inherit; text-decoration:none }
    .container{max-width:1200px;margin:18px auto;padding:18px}
    /* HEADER (from your uploaded header file: see citation) */
    header.site-header{background:#fff; border-bottom:1px solid rgba(0,0,0,0.04)}
    /* We'll render the site header inside the dark page area so override styles below */
    .site-header .brand-wrapper{display:flex;gap:12px;align-items:center}
    .site-header img.logo { height:44px; width:44px; border-radius:10px; object-fit:cover; border:2px solid rgba(249,115,22,0.12) }

    /* dashboard header */
    header.main{display:flex;justify-content:space-between;align-items:center;gap:16px;margin:12px 0 18px 0}
    .brand{display:flex;gap:12px;align-items:center}
    .logo-circle{width:52px;height:52px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-dark));display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff}
    .title{font-size:20px;font-weight:700}
    .subtitle{font-size:13px;color:var(--muted)}
    .top-actions{display:flex;gap:10px;align-items:center}
    .btn{background:var(--accent);color:#071026;padding:9px 14px;border-radius:10px;font-weight:600;cursor:pointer;border:none}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:8px 12px}
    .glass-card{background:var(--glass);padding:10px;border-radius:12px;box-shadow:0 8px 24px rgba(2,6,23,0.5)}
    .grid{display:grid;grid-template-columns:1fr 320px;gap:18px}
    .stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:12px}
    .stat{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.015));padding:14px;border-radius:12px}
    .stat .num{font-size:20px;font-weight:700}
    .panel{background:var(--card);padding:14px;border-radius:12px}
    .products-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .product-card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;overflow:hidden;display:flex;flex-direction:column}
    .product-card img{width:100%;height:150px;object-fit:cover;background:#0b1220}
    .product-body{padding:12px;display:flex;flex-direction:column;gap:8px;flex:1}
    .badge{font-size:12px;padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.04)}
    .pill-available{background:rgba(16,185,129,0.12);color:var(--success);padding:6px 8px;border-radius:8px}
    .actions{display:flex;gap:8px;margin-top:auto}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px 10px}
    .messages{display:flex;flex-direction:column;gap:10px;height:520px}
    .message{display:flex;gap:10px;align-items:flex-start;padding:10px;border-radius:10px}
    .message.unread{background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01))}
    .avatar{width:44px;height:44px;border-radius:10px;background:#0b1220;display:flex;align-items:center;justify-content:center;font-weight:700}
    .msg-body{flex:1}
    .small{font-size:12px;color:var(--muted)}
    footer.site-footer{margin-top:22px;padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));display:flex;justify-content:space-between;align-items:center}
    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:flex;align-items:center;justify-content:center;z-index:60}
    .modal{background:#071226;padding:18px;border-radius:12px;width:420px;box-shadow:0 12px 40px rgba(2,6,23,0.7)}
    input[type="text"], input[type="number"], select{width:100%;padding:10px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit;margin-top:8px}
    label{font-size:13px;color:var(--muted)}
    @media (max-width:1000px){ .grid{grid-template-columns:1fr;} .products-grid{grid-template-columns:repeat(2,1fr)} }
    @media (max-width:640px){ .products-grid{grid-template-columns:1fr} .top-actions{flex-direction:column;align-items:flex-end} }
  </style>
</head>
<body>
  <!-- =======================
       SITE HEADER (from your uploaded header.html)
       I used the uploaded header structure and logo path images/لوجو 3.png.
       Source files: header.html and footer.html (you uploaded them). -->
  <header class="site-header" aria-hidden="false">
    <!-- embedded header content (kept structure from your header file) -->
    <div style="border-bottom:1px solid rgba(0,0,0,0.04);background:#fff;padding:8px 0">
      <div style="max-width:1200px;margin:0 auto;padding:0 18px;display:flex;align-items:center;justify-content:space-between;gap:12px">
        <div style="display:flex;align-items:center;gap:10px">
          <img src="images/لوجو 3.png" onerror="this.src='images/لوجو 1.png'" alt="SudEgy Logo" class="logo" />
          <div>
            <div style="font-weight:800;color:#111;font-size:18px">SudEgy</div>
            <div style="font-size:12px;color:#666">أول منصّة ربط بين السودان ومصر</div>
          </div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="btn-language" style="padding:6px 10px;border-radius:999px;border:1px solid #e6e6e6;background:#fff;color:#333;cursor:pointer">AR / EN</button>
          <a id="nav-login" href="login.html" style="color:#555;font-size:13px">دخول</a>
          <span style="color:#ddd">|</span>
          <a id="nav-register" href="register.html" style="color:#555;font-size:13px">تسجيل جديد</a>
        </div>
      </div>
    </div>
    <div style="background:linear-gradient(90deg,#fff,#fff);padding:8px 0">
      <div style="max-width:1200px;margin:0 auto;padding:0 18px;display:flex;align-items:center;justify-content:space-between">
        <nav style="display:flex;gap:12px;font-size:14px;color:#444">
          <a href="index.html">الرئيسية</a>
          <a href="offers.html">عروض اليوم</a>
          <a href="categories.html">الفئات</a>
        </nav>
        <div style="display:flex;gap:8px;align-items:center">
          <a id="nav-add" href="add-product.html" style="display:inline-block;padding:8px 12px;border-radius:999px;background:#f97316;color:#fff;font-weight:700">أضف منتج</a>
          <a href="user-dashboard.html" style="padding:8px 12px;border-radius:10px;border:1px solid #eee;color:#333">لوحة التحكم</a>
        </div>
      </div>
    </div>
  </header>
  <!-- ======================= -->

  <div class="container">
    <!-- DASHBOARD HEADER -->
    <header class="main">
      <div class="brand">
        <div class="logo-circle">
          <!-- small logo mark: use same logo image but cropped -->
          <img src="images/لوجو 3.png" alt="S" style="height:36px;width:36px;border-radius:8px;object-fit:cover" />
        </div>
        <div>
          <div class="title">لوحة تحكم التاجر</div>
          <div class="subtitle">تحكم بالمنتجات، الرسائل، وتابع أداء متجرك</div>
        </div>
      </div>

      <div class="top-actions">
        <div id="motivational" class="glass-card" style="font-weight:600;font-size:13px">مرحباً — اجذب زبائنك بعروض ذكية اليوم!</div>
        <button class="btn" id="openAdd">أضف منتج</button>
        <button class="btn secondary" id="refreshBtn">تحديث</button>
      </div>
    </header>

    <div class="grid">
      <!-- MAIN -->
      <main>
        <div class="stats-grid">
          <div class="stat">
            <div class="small">الزوار اليوم</div>
            <div class="num" id="statVisitors">—</div>
            <div class="small">نسبة مقارنة بالأمس</div>
          </div>
          <div class="stat">
            <div class="small">الطلبات</div>
            <div class="num" id="statOrders">—</div>
            <div class="small">قيد التنفيذ: <span id="statPending">—</span></div>
          </div>
          <div class="stat">
            <div class="small">إيراد اليوم</div>
            <div class="num" id="statRevenue">—</div>
            <div class="small">متوسط يومي</div>
          </div>
          <div class="stat">
            <div class="small">المنتجات</div>
            <div class="num" id="statProducts">—</div>
            <div class="small">مميزة: <span id="statFeatured">—</span></div>
          </div>
        </div>

        <section class="panel glass-card">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <h3 style="margin:0">أحدث المنتجات</h3>
            <div style="display:flex;gap:8px;align-items:center">
              <input id="searchInput" placeholder="ابحث عن منتج..." style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
              <select id="filterSelect" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
                <option value="all">الكل</option>
                <option value="featured">مميزة</option>
                <option value="stock">في المخزن</option>
                <option value="out">نفدت</option>
              </select>
            </div>
          </div>

          <div id="productsGrid" class="products-grid"></div>

          <div style="margin-top:12px;font-size:13px;color:var(--muted)">نصيحة: صور واضحة ووصف مختصر يساعد المشترين. جرّب إضافة خصم محدود لجذب أول المشترين.</div>
        </section>

        <section class="panel glass-card" style="margin-top:12px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h3 style="margin:0">أداء المبيعات (آخر 7 أيام)</h3>
            <div class="small">تحديث تلقائي</div>
          </div>
          <canvas id="salesChart" style="width:100%;height:220px;margin-top:12px"></canvas>
        </section>
      </main>

      <!-- SIDEBAR -->
      <aside>
        <div class="panel glass-card messages">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <h4 style="margin:0">الرسائل</h4>
            <div style="display:flex;gap:8px;align-items:center">
              <button class="btn secondary" id="markAllRead">وضع مقروء</button>
              <div class="small" id="unreadCount">—</div>
            </div>
          </div>

          <div id="messagesList" style="overflow:auto;padding-right:6px"></div>

          <div style="margin-top:auto">
            <input id="replyInput" placeholder="اكتب رد سريع..." style="padding:9px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
            <div style="display:flex;gap:8px;margin-top:8px">
              <button class="btn" id="sendQuick">إرسال</button>
              <button class="btn secondary" id="openAll">فتح الكل</button>
            </div>
          </div>
        </div>

        <div class="panel glass-card" style="margin-top:12px">
          <h4 style="margin:0">نصيحة للتاجر</h4>
          <p id="motivationText" class="small" style="margin-top:8px">ابدأ بعروض صغيرة لرفع التقييمات خلال أول أسبوع.</p>
        </div>

        <div class="panel glass-card" style="margin-top:12px">
          <h4 style="margin:0">إجراءات سريعة</h4>
          <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
            <button class="btn" id="quickAdd">أضف منتج</button>
            <button class="btn secondary">عرض الطلبات اليوم</button>
            <button class="btn ghost" style="background:transparent">إعدادات المتجر</button>
          </div>
        </div>
      </aside>
    </div>

    <!-- FOOTER (from your uploaded footer.html) -->
    <footer class="site-footer">
      <div style="max-width:1200px;margin:0 auto;padding:0 18px;display:flex;justify-content:space-between;align-items:center;gap:8px;color:#9aa8b8;font-size:13px">
        <span>© SudEgy - 2025</span>
        <span>منصة لربط التجار والموردين بين مصر والسودان.</span>
      </div>
    </footer>
    <!-- ======================= -->

  </div>

  <!-- modal root -->
  <div id="modalRoot" style="display:none"></div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <script>
    // --- sample data (replace with API integration) ---
    let sampleMessages = [
      { id:1, from:'عميل ١', text:'هل المنتج دا عليه ضمان؟', time:'قبل 2 س', unread:true },
      { id:2, from:'عميل ٢', text:'كم مدة الشحن للقاهرة؟', time:'قبل 5 س', unread:true },
      { id:3, from:'مشتري مهم', text:'هل في خصم للطلب الأكبر؟', time:'أمس', unread:false }
    ];

    let sampleProducts = [
      { id:101, title:'شاحن سريع 30W', price:159, stock:0, featured:false, img:'images/شاحن سريع 30W.jpg' },
      { id:102, title:'قميص قطني فاخر', price:249, stock:12, featured:false, img:'images/قميص قطني فاخر.jpg' },
      { id:103, title:'سماعات بلوتوث', price:399, stock:5, featured:true, img:'images/سماعات بلوتوث.jpg' },
      { id:104, title:'حقيبة ظهر متينة', price:599, stock:3, featured:false, img:'images/حقيبة ظهر متينة.jpg' },
      { id:105, title:'إسورة ذكية', price:899, stock:8, featured:true, img:'images/إسورة ذكية.jpg' },
      { id:106, title:'كوب حراري', price:89, stock:20, featured:false, img:'images/كوب حراري.jpg' }
    ];

    const stats = {
      visitors: 1522, orders: 41, pending: 2, revenue: 9706,
      products: sampleProducts.length, featured: sampleProducts.filter(p=>p.featured).length
    };

    const phrases = [
      "زيد مبيعاتك اليوم — فعّل منتج مميز!",
      "صورة واضحة + وصف موجز = زيادة تحويلات",
      "جرّب عرض 10% للزوار الجدد",
      "استجب للرسائل خلال ساعة لتحسين التقييم",
      "ارفع 3 منتجات جديدة كل أسبوع لجذب الزيارات"
    ];

    const el = id => document.getElementById(id);

    function renderStats(){
      el('statVisitors').textContent = stats.visitors.toLocaleString();
      el('statOrders').textContent = stats.orders;
      el('statPending').textContent = stats.pending;
      el('statRevenue').textContent = 'ج.م ' + stats.revenue.toLocaleString();
      el('statProducts').textContent = stats.products;
      el('statFeatured').textContent = stats.featured;
    }

    function renderMessages(){
      const wrap = el('messagesList');
      wrap.innerHTML = '';
      sampleMessages.forEach(msg=>{
        const div = document.createElement('div');
        div.className = 'message ' + (msg.unread ? 'unread' : '');
        div.innerHTML = `
          <div class="avatar">${msg.from.slice(0,1)}</div>
          <div class="msg-body">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div style="font-weight:700">${msg.from}</div>
              <div class="small">${msg.time}</div>
            </div>
            <div style="margin-top:6px" class="small">${msg.text}</div>
            <div style="margin-top:8px;display:flex;gap:6px">
              <button class="btn" onclick="replyQuick(${msg.id})">رد سريع</button>
              <button class="btn ghost" onclick="toggleRead(${msg.id})">${msg.unread ? 'وضع مقروء' : 'وضع غير مقروء'}</button>
            </div>
          </div>
        `;
        wrap.appendChild(div);
      });
      updateUnreadCount();
    }

    function updateUnreadCount(){ el('unreadCount').textContent = `غير مقروء: ${sampleMessages.filter(m=>m.unread).length}`; }

    function renderProducts(filter='all', query=''){
      const grid = el('productsGrid'); grid.innerHTML = '';
      let list = [...sampleProducts];
      if (filter==='featured') list = list.filter(p=>p.featured);
      if (filter==='stock') list = list.filter(p=>p.stock>0);
      if (filter==='out') list = list.filter(p=>p.stock===0);
      if (query) list = list.filter(p => p.title.toLowerCase().includes(query.toLowerCase()));
      if (list.length===0){ grid.innerHTML = '<div class="small" style="padding:18px">لا توجد نتائج</div>'; return; }

      list.forEach(p=>{
        const card = document.createElement('div'); card.className = 'product-card';
        card.innerHTML = `
          <img src="${p.img}" alt="${p.title}" loading="lazy">
          <div class="product-body">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div style="font-weight:700">${p.title}</div>
                <div class="small" style="margin-top:6px">ج.م ${p.price.toLocaleString()}</div>
              </div>
              <div class="${p.stock>0 ? 'pill-available' : 'badge'}">${p.stock>0 ? 'متوفر' : 'نفد'}</div>
            </div>
            <div class="actions">
              <button class="btn" onclick="toggleFeature(${p.id})">${p.featured ? 'إزالة من المميزة' : 'تمييز'}</button>
              <button class="btn ghost" onclick="publishHome(${p.id})">نشر</button>
            </div>
            <div class="small" style="margin-top:8px">المعرف: ${p.id}</div>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    function replyQuick(id){
      const text = el('replyInput').value.trim();
      if (!text) return alert('اكتب رسالة للارسال');
      el('replyInput').value = '';
      alert('تم إرسال الرد (تجريبي)');
      const m = sampleMessages.find(x=>x.id===id); if (m) m.unread=false;
      renderMessages();
    }

    function toggleRead(id){ const m = sampleMessages.find(x=>x.id===id); if (m) m.unread = !m.unread; renderMessages(); }
    function publishHome(id){ alert('تم نشر المنتج للصفحة الرئيسية (تجريبي) — المنتج: ' + id); }
    function toggleFeature(id){ const p = sampleProducts.find(x=>x.id===id); if (!p) return; p.featured = !p.featured; stats.featured = sampleProducts.filter(p=>p.featured).length; renderProducts(el('filterSelect').value, el('searchInput').value); renderStats(); }

    function markAllRead(){ sampleMessages.forEach(m=>m.unread=false); renderMessages(); }

    // Chart: destroy previous chart before creating (fixes Canvas already in use)
    function initChart(){
      const canvas = el('salesChart');
      if (window.salesChart){ try{ window.salesChart.destroy(); } catch(e){ console.warn(e); } window.salesChart = null; }
      const ctx = canvas.getContext('2d');
      const labels = ['6 أيام','5 أيام','4 أيام','3 أيام','2 أيام','أمس','اليوم'];
      const data = [600,720,540,810,900,760, stats.revenue];
      window.salesChart = new Chart(ctx, {
        type: 'line',
        data: { labels, datasets:[{ label:'المبيعات (ج.م)', data, fill:true, tension:0.3, borderWidth:2, pointRadius:3 }] },
        options:{ plugins:{legend:{display:false}}, scales:{ x:{grid:{display:false}, ticks:{color:'#9fb0c8'}}, y:{grid:{color:'rgba(255,255,255,0.03)'}, ticks:{color:'#9fb0c8'}} } }
      });
    }

    // modal
    function openAddModal(defaultData={}) {
      const root = el('modalRoot'); root.style.display = 'block';
      root.innerHTML = `<div class="modal-backdrop" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
          <h3 style="margin:0 0 10px 0">أضف منتج جديد</h3>
          <label>اسم المنتج</label><input id="m_title" type="text" value="${defaultData.title||''}" />
          <label>السعر (ج.م)</label><input id="m_price" type="number" value="${defaultData.price||100}" />
          <label>الكمية</label><input id="m_stock" type="number" value="${defaultData.stock||1}" />
          <label>رابط الصورة</label><input id="m_img" type="text" value="${defaultData.img||''}" placeholder="images/your-image.jpg" />
          <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
            <button class="btn secondary" onclick="closeModal()">إلغاء</button>
            <button class="btn" onclick="saveNewProduct()">حفظ المنتج</button>
          </div>
        </div></div>`;
    }
    function closeModal(e){ const root = el('modalRoot'); root.style.display = 'none'; root.innerHTML = ''; }

    function saveNewProduct(){
      const title = el('m_title').value.trim();
      const price = Number(el('m_price').value) || 0;
      const stock = Number(el('m_stock').value) || 0;
      const img = el('m_img').value.trim() || 'images/placeholder-new.jpg';
      if (!title) return alert('حدد اسم المنتج');
      const id = Math.floor(Date.now()/1000);
      const newP = { id, title, price, stock, featured:false, img };
      sampleProducts.unshift(newP); stats.products = sampleProducts.length;
      renderProducts(el('filterSelect').value, el('searchInput').value); renderStats(); closeModal();
      alert('تمت إضافة المنتج مؤقتًا (تجريبي). ربط الحفظ بالـ API مطلوب.');
    }

    // events
    el('refreshBtn').addEventListener('click', ()=> { randomizeStats(); renderStats(); renderProducts(el('filterSelect').value, el('searchInput').value); renderMessages(); initChart(); });
    el('filterSelect').addEventListener('change', (e)=> renderProducts(e.target.value, el('searchInput').value));
    el('searchInput').addEventListener('input', (e)=> renderProducts(el('filterSelect').value, e.target.value));
    el('markAllRead').addEventListener('click', markAllRead);
    el('sendQuick').addEventListener('click', ()=> replyQuick(sampleMessages[0]?.id || 1));
    el('openAll').addEventListener('click', ()=> alert('فتح المحادثات (تجريبي)'));
    el('openAdd').addEventListener('click', ()=> openAddModal());
    el('quickAdd').addEventListener('click', ()=> openAddModal());

    function randomizeStats(){ stats.visitors = Math.max(200, stats.visitors + Math.floor(Math.random()*200 - 50)); stats.orders = Math.max(0, stats.orders + Math.floor(Math.random()*6 - 2)); stats.pending = Math.max(0, Math.floor(Math.random()*7)); stats.revenue = Math.max(0, stats.revenue + Math.floor(Math.random()*1200 - 300)); stats.products = sampleProducts.length; stats.featured = sampleProducts.filter(p=>p.featured).length; }

    let phraseIndex = 0;
    function rotatePhrase(){ phraseIndex = (phraseIndex+1) % phrases.length; el('motivational').textContent = phrases[phraseIndex]; el('motivationText').textContent = phrases[phraseIndex] + " — ابدأ الآن!"; }
    setInterval(rotatePhrase,7000);

    (function init(){ renderStats(); renderMessages(); renderProducts(); initChart(); el('refreshBtn').click(); })();
  </script>
</body>
</html>
